<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Search Dreams â€“ Dream Decoder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="dd-body dd-dark">

  <div class="dd-app">

    <!-- Top bar -->
    <header class="dd-header">
      <div class="dd-logo">Dream Decoder</div>
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <a href="{{ url_for('index') }}" class="dd-icon-button" aria-label="Back to Dream Input">
          â¬…
        </a>
        <a href="{{ url_for('history') }}" class="dd-icon-button" aria-label="View Dream History">
          ðŸ•’
        </a>
        <button id="theme-toggle" class="dd-icon-button" aria-label="Toggle theme">
          ðŸŒ™
        </button>
      </div>
    </header>

    <main class="dd-main">
      <section class="dd-input-card">
        <h1 class="dd-title">Search Dreams</h1>
        <p class="dd-label" style="margin-bottom: 0.75rem;">
          Search across titles, raw dream text, context, motifs, and interpretations.
        </p>

        <form method="get" action="{{ url_for('search') }}" style="margin-bottom: 1.25rem;">
          <label for="q" class="dd-label">Search query</label>
          <input type="text" id="q" name="q" class="dd-input"
                 placeholder="e.g. cat, falling, Thanksgiving, anxiety"
                 value="{{ query or '' }}" />
          <button type="submit" class="dd-primary-button" style="margin-top: 0.75rem;">
            Search
          </button>
        </form>

        {% if query %}
          <p class="dd-label" style="margin-bottom: 0.5rem;">
            Results for <strong>"{{ query }}"</strong>:
          </p>

          {% if results and results|length > 0 %}
            <ul style="list-style: none; padding: 0; margin: 0;">
              {% for rec in results %}
                <li style="margin-bottom: 0.9rem;">
                  <a href="{{ url_for('history_detail', idx=rec.idx) }}"
                     style="text-decoration: none; color: #e7eaf0;">
                    <div style="font-size: 0.95rem; font-weight: 500;">
                      {{ rec.title }}
                    </div>
                    <div style="font-size: 0.8rem; color: #a5acb8;">
                      {{ rec.timestamp }}
                    </div>
                    {% if rec.felt_during or rec.felt_after %}
                      <div style="font-size: 0.8rem; color: #a5acb8; margin-top: 0.15rem;">
                        During: {{ rec.felt_during or "â€”" }} |
                        After: {{ rec.felt_after or "â€”" }}
                      </div>
                    {% endif %}
                    {% if rec.snippet %}
                      <div style="font-size: 0.8rem; color: #c3c8d4; margin-top: 0.25rem;">
                        {{ rec.snippet }}
                      </div>
                    {% endif %}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="dd-label" style="margin-top: 0.5rem;">
              No dreams matched that query.
            </p>
          {% endif %}
        {% else %}
          <p class="dd-label">
            Enter a word or phrase to search your dream diary.
          </p>
        {% endif %}
      </section>
    </main>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>
